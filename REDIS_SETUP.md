# ğŸš€ Redis ìºì‹± ì‹œìŠ¤í…œ ë„ì… ì™„ë£Œ

ì´ í”„ë¡œì íŠ¸ì— Redis ìºì‹± ì‹œìŠ¤í…œì´ ì„±ê³µì ìœ¼ë¡œ ë„ì…ë˜ì—ˆìŠµë‹ˆë‹¤.

## ğŸ“¦ ì„¤ì¹˜ëœ íŒ¨í‚¤ì§€

```bash
npm install @nestjs/cache-manager cache-manager cache-manager-redis-store redis
```

## ğŸ—ï¸ êµ¬ì¡°

```
src/
â”œâ”€â”€ cache/
â”‚   â”œâ”€â”€ cache.module.ts     # Redis ì„¤ì • ëª¨ë“ˆ
â”‚   â””â”€â”€ cache.service.ts    # ìºì‹œ ê´€ë¦¬ ì„œë¹„ìŠ¤
â”œâ”€â”€ essays/
â”‚   â”œâ”€â”€ essays.service.ts   # AI í‰ê°€ ê²°ê³¼ ìºì‹± ì ìš©
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ openai.service.ts # AI í‰ê°€ ìºì‹±
â””â”€â”€ health/
    â””â”€â”€ health.controller.ts # Redis ìƒíƒœ ì²´í¬
```

## âš™ï¸ í™˜ê²½ ì„¤ì •

### 1. í™˜ê²½ë³€ìˆ˜ ì¶”ê°€ (.env)
```env
# Redis Configuration
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
```

### 2. Dockerë¡œ Redis ì„œë²„ ì‹¤í–‰
```bash
# Redis + PostgreSQL í•¨ê»˜ ì‹¤í–‰
docker-compose up -d

# Redisë§Œ ì‹¤í–‰
docker run -d --name redis -p 6379:6379 redis:alpine
```

## ğŸ”¥ ìºì‹± ì ìš© ì˜ì—­

### 1. **AI í‰ê°€ ê²°ê³¼ ìºì‹±** (High Impact)
- **ìœ„ì¹˜**: `src/essays/services/openai.service.ts`
- **TTL**: 24ì‹œê°„
- **í‚¤ íŒ¨í„´**: `ai-eval:{hash}`
- **íš¨ê³¼**: ë™ì¼í•œ í…ìŠ¤íŠ¸ ì¬í‰ê°€ ë°©ì§€ë¡œ API ë¹„ìš© ì ˆê°

### 2. **í•™ìƒ ì •ë³´ ìºì‹±** (Medium Impact)  
- **ìœ„ì¹˜**: `src/essays/essays.service.ts`
- **TTL**: 1ì‹œê°„
- **í‚¤ íŒ¨í„´**: `student:{studentId}`
- **íš¨ê³¼**: í•™ìƒ ì •ë³´ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ

### 3. **ì—ì„¸ì´ ì •ë³´ ìºì‹±** (Medium Impact)
- **ìœ„ì¹˜**: `src/essays/essays.service.ts`  
- **TTL**: 30ë¶„
- **í‚¤ íŒ¨í„´**: `essay:{essayId}`
- **íš¨ê³¼**: ì—ì„¸ì´ ìƒì„¸ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ

## ğŸ“Š í—¬ìŠ¤ì²´í¬

### API ì—”ë“œí¬ì¸íŠ¸
```bash
# ì „ì²´ í—¬ìŠ¤ì²´í¬ (DB + Redis)
GET /v1/health

# Redis ì „ìš© í—¬ìŠ¤ì²´í¬  
GET /v1/health/redis
```

### ì‘ë‹µ ì˜ˆì‹œ
```json
{
  "status": "ok",
  "info": {
    "database": {
      "status": "up"
    },
    "redis": {
      "status": "up"
    }
  }
}
```

## ğŸ”„ ìºì‹œ ë¬´íš¨í™” ì „ëµ

### ìë™ ë¬´íš¨í™”
- ì—ì„¸ì´ ìƒì„±/ìˆ˜ì • ì‹œ ê´€ë ¨ ìºì‹œ ìë™ ì‚­ì œ
- í•™ìƒ ì •ë³´ ë³€ê²½ ì‹œ ê´€ë ¨ ìºì‹œ ë¬´íš¨í™”

### ìˆ˜ë™ ë¬´íš¨í™” (í•„ìš”ì‹œ)
```typescript
// íŠ¹ì • í‚¤ ì‚­ì œ
await this.cacheService.del('student:123');

// í•™ìƒ ê´€ë ¨ ëª¨ë“  ìºì‹œ ì‚­ì œ
await this.cacheService.invalidateStudentEssaysCache(123);
```

## ğŸ“ˆ ì„±ëŠ¥ í–¥ìƒ ì˜ˆìƒ íš¨ê³¼

| ì˜ì—­ | ê¸°ì¡´ | ìºì‹œ ì ìš© í›„ | ê°œì„ ìœ¨ |
|------|------|-------------|---------|
| AI í‰ê°€ (ë™ì¼ í…ìŠ¤íŠ¸) | 3-5ì´ˆ | ~50ms | **99%** |
| í•™ìƒ ì •ë³´ ì¡°íšŒ | 50-100ms | ~5ms | **90%** |
| ì—ì„¸ì´ ì¡°íšŒ | 30-50ms | ~3ms | **85%** |

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### 1. Redis ì„œë²„ ì‹œì‘
```bash
docker-compose up -d redis
```

### 2. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
```bash
npm run start:dev
```

### 3. ìºì‹œ ë™ì‘ í™•ì¸
```bash
# ì²« ë²ˆì§¸ ìš”ì²­ (ìºì‹œ ë¯¸ìŠ¤)
curl "http://localhost:3000/v1/essays/1" 

# ë‘ ë²ˆì§¸ ìš”ì²­ (ìºì‹œ íˆíŠ¸ - í›¨ì”¬ ë¹ ë¦„)
curl "http://localhost:3000/v1/essays/1"
```

## ğŸ”§ ëª¨ë‹ˆí„°ë§

### Redis ìƒíƒœ í™•ì¸
```bash
# Redis CLI ì ‘ì†
docker exec -it submission-eval-redis redis-cli

# ì €ì¥ëœ í‚¤ í™•ì¸
KEYS *

# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸  
INFO memory
```

### ë¡œê·¸ í™•ì¸
- ìºì‹œ íˆíŠ¸/ë¯¸ìŠ¤ ë¡œê·¸ëŠ” ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì¶œë ¥
- í”„ë¡œë•ì…˜ì—ì„œëŠ” ì„±ëŠ¥ìƒ ë¡œê·¸ ìµœì†Œí™”

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ë©”ëª¨ë¦¬ ê´€ë¦¬**: TTL ì„¤ì •ìœ¼ë¡œ ìë™ ë§Œë£Œ ê´€ë¦¬
2. **ë°ì´í„° ì¼ê´€ì„±**: ìºì‹œ ë¬´íš¨í™” ì „ëµ ì¤€ìˆ˜
3. **ì¥ì•  ëŒ€ì‘**: Redis ì¥ì•  ì‹œ DB ì§ì ‘ ì¡°íšŒë¡œ fallback
4. **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**: Redis ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì •ê¸° ì²´í¬

## ğŸ”® í–¥í›„ í™•ì¥ ê³„íš

1. **ì„¸ì…˜ ìºì‹±**: JWT í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬
2. **API ì‘ë‹µ ìºì‹±**: ì½ê¸° ì „ìš© ì—”ë“œí¬ì¸íŠ¸ ìºì‹±
3. **ë°°ì¹˜ ìºì‹±**: ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì‹œ ì¤‘ê°„ ê²°ê³¼ ìºì‹±
4. **ë¶„ì‚° ìºì‹±**: Redis Cluster ë„ì… ê²€í† 

---

ğŸ‰ **Redis ìºì‹± ì‹œìŠ¤í…œì´ ì„±ê³µì ìœ¼ë¡œ ë„ì…ë˜ì—ˆìŠµë‹ˆë‹¤!**  
ì„±ëŠ¥ í–¥ìƒê³¼ ì„œë²„ ë¶€í•˜ ê°ì†Œ íš¨ê³¼ë¥¼ ê²½í—˜í•´ë³´ì„¸ìš”.